name: Deployment

on:
  push:
    tags:
      - v[0-9]+.[0-9]+.[0-9]+*

jobs:
  deploy:

    runs-on: windows-latest

    steps:

    - name: Checkout
      uses: actions/checkout@v5
      with:
        fetch-depth: 0

    - name: Install GitVersion
      uses: gittools/actions/gitversion/setup@v4.1.0
      with:
        versionSpec: '6.1.x'

    - name: Determine Version
      id: gitversion # step id used as a reference for output values
      uses: gittools/actions/gitversion/execute@v4.1.0

    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v2

    - name: Build and Package with MSBuild
      working-directory: src
      run: msbuild -t:"Clean;Pack" -restore -p:Configuration=Release -p:"Version=${{ steps.gitversion.outputs.fullSemVer }}" LpSolveDotNet.sln

    - name: Setup Nuget.exe
      uses: nuget/setup-nuget@v2
      with:
        nuget-api-key: ${{ secrets.NUGET_APIKEY }}
        nuget-version: '5.x'

    - name: Push to nuget.org
      run: nuget push "build\output\nuget\LpSolveDotNet.*.nupkg" -NoSymbols -Source https://api.nuget.org/v3/index.json
